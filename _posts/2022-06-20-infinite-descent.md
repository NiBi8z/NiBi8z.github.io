---
title: "CryptoHack - Infinite Descent"
author: NiBi
lang: "en"
categories : ['CryptoHack']
tags : ['Challenge', 'RSA','crypto','math','modular math','factorization']
titlepage: true
toc: true
toc-own-page: true
---

### Instructions : 

Finding large primes is slow, so I've devised an optimisation.

descent.py

output.txt


Descent.py 
```python
#!/usr/bin/env python3

import random
from Crypto.Util.number import bytes_to_long, isPrime

FLAG = b"crypto{???????????????????}"


def getPrimes(bitsize):
    r = random.getrandbits(bitsize)
    p, q = r, r
    while not isPrime(p):
        p += random.getrandbits(bitsize//4)
    while not isPrime(q):
        q += random.getrandbits(bitsize//8)
    return p, q


m = bytes_to_long(FLAG)
p, q = getPrimes(2048)
n = p * q
e = 0x10001
c = pow(m, e, n)

print(f"n = {n}")
print(f"e = {e}")
print(f"c = {c}")
```

output.txt
```text
n = 383347712330877040452238619329524841763392526146840572232926924642094891453979246383798913394114305368360426867021623649667024217266529000859703542590316063318592391925062014229671423777796679798747131250552455356061834719512365575593221216339005132464338847195248627639623487124025890693416305788160905762011825079336880567461033322240015771102929696350161937950387427696385850443727777996483584464610046380722736790790188061964311222153985614287276995741553706506834906746892708903948496564047090014307484054609862129530262108669567834726352078060081889712109412073731026030466300060341737504223822014714056413752165841749368159510588178604096191956750941078391415634472219765129561622344109769892244712668402761549412177892054051266761597330660545704317210567759828757156904778495608968785747998059857467440128156068391746919684258227682866083662345263659558066864109212457286114506228470930775092735385388316268663664139056183180238043386636254075940621543717531670995823417070666005930452836389812129462051771646048498397195157405386923446893886593048680984896989809135802276892911038588008701926729269812453226891776546037663583893625479252643042517196958990266376741676514631089466493864064316127648074609662749196545969926051
e = 65537
c = 98280456757136766244944891987028935843441533415613592591358482906016439563076150526116369842213103333480506705993633901994107281890187248495507270868621384652207697607019899166492132408348789252555196428608661320671877412710489782358282011364127799563335562917707783563681920786994453004763755404510541574502176243896756839917991848428091594919111448023948527766368304503100650379914153058191140072528095898576018893829830104362124927140555107994114143042266758709328068902664037870075742542194318059191313468675939426810988239079424823495317464035252325521917592045198152643533223015952702649249494753395100973534541766285551891859649320371178562200252228779395393974169736998523394598517174182142007480526603025578004665936854657294541338697513521007818552254811797566860763442604365744596444735991732790926343720102293453429936734206246109968817158815749927063561835274636195149702317415680401987150336994583752062565237605953153790371155918439941193401473271753038180560129784192800351649724465553733201451581525173536731674524145027931923204961274369826379325051601238308635192540223484055096203293400419816024111797903442864181965959247745006822690967920957905188441550106930799896292835287867403979631824085790047851383294389
```

### Solution : 

Here we see that the user try to find a prime number by himself. Generating a prime number is difficult. Maybe his program failed and his number is not prime.

With [alpertron](https://www.alpertron.com.ar/ECM.HTM) we can check if a number is prime or not.

![image](../../assets/infinite-descent-not-prime.png)

Clicking the "Prime" button we see that n is not prime !

Let's try to factorize it to retrieve n Euler's totient.

![image](../../assets/infite_totient.png)

Wow ! After 2 seconds we have p and q !

We can compute tot(n) which is (p-1)*(q-1).

Alpertron did the math for us.

```text
Euler's totient: 383 347712 330877 040452 238619 329524 841763 392526 146840 572232 926924 642094 891453 979246 383798 913394 114305 368360 426867 021623 649667 024217 266529 000859 703542 590316 063318 592391 925062 014229 671423 777796 679798 747131 250552 455356 061834 719512 365575 593221 216339 005132 464338 847195 248627 639623 487124 025890 693416 305788 160905 762011 825079 336880 567461 033322 240015 771102 929696 350161 937950 387427 696385 850443 727777 996483 584464 610046 380722 736790 790188 061964 311222 153985 614287 276995 741553 706506 834906 746892 708903 948496 564047 090014 307484 054609 862129 530262 108669 567834 726352 078060 081889 712109 412073 731026 030466 300060 341737 504223 822014 714056 413752 126683 214547 210091 390679 974594 283534 409697 353269 403167 247339 061084 988048 579364 531632 101433 020183 194468 283153 033890 703002 087973 385851 417790 266280 499708 266344 223641 316926 576294 365165 329347 064523 975790 670588 810818 699922 179788 777857 170439 166954 960703 459198 529275 452877 513873 057382 770768 245397 145016 125891 706702 616839 846581 497389 530380 476502 301836 798763 392640 359463 913664 694387 882032 507902 993040 076634 403215 964044 533033 051743 329783 326275 960406 613436 618673 703137 751078 621791 878904 659539 323881 991701 429815 539158 631194 285131 479771 286920 247793 977358 272614 673235 455213 699514 908669 035434 237697 206139 833951 794028 820271 248992 213600
```

We know that d is the inverse of e mod tot(n).

Using python we can find d easily : 

```python
from Crypto.Util.number import long_to_bytes

#I copied tot from the website and removed spaces to have an integer.
tot='383 347712 330877 040452 238619 329524 841763 392526 146840 572232 926924 642094 891453 979246 383798 913394 114305 368360 426867 021623 649667 024217 266529 000859 703542 590316 063318 592391 925062 014229 671423 777796 679798 747131 250552 455356 061834 719512 365575 593221 216339 005132 464338 847195 248627 639623 487124 025890 693416 305788 160905 762011 825079 336880 567461 033322 240015 771102 929696 350161 937950 387427 696385 850443 727777 996483 584464 610046 380722 736790 790188 061964 311222 153985 614287 276995 741553 706506 834906 746892 708903 948496 564047 090014 307484 054609 862129 530262 108669 567834 726352 078060 081889 712109 412073 731026 030466 300060 341737 504223 822014 714056 413752 126683 214547 210091 390679 974594 283534 409697 353269 403167 247339 061084 988048 579364 531632 101433 020183 194468 283153 033890 703002 087973 385851 417790 266280 499708 266344 223641 316926 576294 365165 329347 064523 975790 670588 810818 699922 179788 777857 170439 166954 960703 459198 529275 452877 513873 057382 770768 245397 145016 125891 706702 616839 846581 497389 530380 476502 301836 798763 392640 359463 913664 694387 882032 507902 993040 076634 403215 964044 533033 051743 329783 326275 960406 613436 618673 703137 751078 621791 878904 659539 323881 991701 429815 539158 631194 285131 479771 286920 247793 977358 272614 673235 455213 699514 908669 035434 237697 206139 833951 794028 820271 248992 213600'
tot=int(''.join(tot.split(' ')))
n=383347712330877040452238619329524841763392526146840572232926924642094891453979246383798913394114305368360426867021623649667024217266529000859703542590316063318592391925062014229671423777796679798747131250552455356061834719512365575593221216339005132464338847195248627639623487124025890693416305788160905762011825079336880567461033322240015771102929696350161937950387427696385850443727777996483584464610046380722736790790188061964311222153985614287276995741553706506834906746892708903948496564047090014307484054609862129530262108669567834726352078060081889712109412073731026030466300060341737504223822014714056413752165841749368159510588178604096191956750941078391415634472219765129561622344109769892244712668402761549412177892054051266761597330660545704317210567759828757156904778495608968785747998059857467440128156068391746919684258227682866083662345263659558066864109212457286114506228470930775092735385388316268663664139056183180238043386636254075940621543717531670995823417070666005930452836389812129462051771646048498397195157405386923446893886593048680984896989809135802276892911038588008701926729269812453226891776546037663583893625479252643042517196958990266376741676514631089466493864064316127648074609662749196545969926051
e=65537
c=98280456757136766244944891987028935843441533415613592591358482906016439563076150526116369842213103333480506705993633901994107281890187248495507270868621384652207697607019899166492132408348789252555196428608661320671877412710489782358282011364127799563335562917707783563681920786994453004763755404510541574502176243896756839917991848428091594919111448023948527766368304503100650379914153058191140072528095898576018893829830104362124927140555107994114143042266758709328068902664037870075742542194318059191313468675939426810988239079424823495317464035252325521917592045198152643533223015952702649249494753395100973534541766285551891859649320371178562200252228779395393974169736998523394598517174182142007480526603025578004665936854657294541338697513521007818552254811797566860763442604365744596444735991732790926343720102293453429936734206246109968817158815749927063561835274636195149702317415680401987150336994583752062565237605953153790371155918439941193401473271753038180560129784192800351649724465553733201451581525173536731674524145027931923204961274369826379325051601238308635192540223484055096203293400419816024111797903442864181965959247745006822690967920957905188441550106930799896292835287867403979631824085790047851383294389

d=pow(e,-1,tot)

decipher=pow(c,d,n)

print(long_to_bytes(decipher))

```
